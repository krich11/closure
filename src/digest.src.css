@import "../src/shared.css";

/* ─── Digest-specific styles (Magazine / Editorial) ────────────── */
@layer components {
  /* Layout */
  .digest-container {
    @apply max-w-[900px] mx-auto;
    padding: 2.5rem 1.5rem;
  }

  /* ── Masthead ─────────────────────────────────────────────────── */
  .masthead {
    @apply text-center pb-10 mb-10;
    border-bottom: 1px solid var(--color-border);
  }

  .masthead-brand {
    @apply flex flex-col items-center gap-2;
  }

  .masthead-logo {
    @apply w-12 h-12 opacity-80;
  }

  .masthead h1 {
    @apply font-serif font-bold text-4xl tracking-tight m-0;
    letter-spacing: -0.02em;
  }

  .masthead-date {
    @apply font-serif italic text-ink-secondary mt-2 text-lg;
  }

  /* ── Lead Story ───────────────────────────────────────────────── */
  .lead-story {
    @apply text-center mb-16;
  }

  .headline {
    @apply font-serif text-3xl font-normal mb-2;
  }

  .subhead {
    @apply text-ink-secondary text-lg mb-10 max-w-xl mx-auto;
  }

  .stats-grid {
    @apply grid grid-cols-4 gap-6 max-w-3xl mx-auto;
  }

  .stat-card {
    @apply flex flex-col items-center p-5 bg-card rounded-lg;
    border: 1px solid var(--color-border);
    box-shadow: 0 2px 4px rgba(0,0,0,0.02);
  }

  .stat-number {
    @apply font-serif text-3xl font-bold text-warm;
  }

  .stat-label {
    @apply text-xs uppercase tracking-widest text-ink-muted mt-2;
  }

  /* ── Topics Card (expandable) ─────────────────────────────────── */
  .stat-card--topics {
    position: relative;
    transition: border-color 0.2s ease;
  }

  .stat-card--topics[aria-expanded="true"] {
    border-color: var(--color-warm);
  }

  .stat-badge {
    @apply text-[10px] font-semibold uppercase tracking-wide mt-1.5 py-0.5 px-2 rounded-sm;
    white-space: nowrap;
  }

  .stat-badge--ai {
    color: var(--color-green);
    background: color-mix(in srgb, var(--color-green) 12%, transparent);
    border: 1px solid color-mix(in srgb, var(--color-green) 30%, transparent);
  }

  .stat-badge--fallback {
    color: var(--color-ink-muted);
    background: color-mix(in srgb, var(--color-ink-muted) 8%, transparent);
    border: 1px solid var(--color-border);
  }

  .stat-badge--pending {
    color: var(--color-yellow);
    background: color-mix(in srgb, var(--color-yellow) 10%, transparent);
    border: 1px solid color-mix(in srgb, var(--color-yellow) 25%, transparent);
    animation: pulse-badge 1.5s ease-in-out infinite;
  }

  @keyframes pulse-badge {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .topic-list {
    @apply mt-3 pt-3 text-left text-xs text-ink-secondary w-full;
    border-top: 1px solid var(--color-border);
    list-style: none;
    padding: 0;
    margin-left: 0;
    margin-right: 0;
  }

  .topic-list li {
    @apply py-0.5 px-1;
    line-height: 1.6;
  }

  .topic-list li::before {
    content: "›  ";
    color: var(--color-warm);
    font-weight: 600;
  }

  /* Stat card action buttons */
  .btn-stat-action {
    @apply mt-3 py-1.5 px-4 rounded text-xs font-medium cursor-pointer;
    background: transparent;
    color: var(--color-warm);
    border: 1px solid var(--color-border);
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
  }

  .btn-stat-action:hover {
    border-color: var(--color-warm);
    background-color: var(--color-warm);
    color: var(--color-white);
  }

  .btn-stat-action:disabled {
    @apply opacity-60 cursor-not-allowed;
  }

  /* ── Actions Bar ──────────────────────────────────────────────── */
  .actions-bar {
    @apply flex justify-between items-center mb-10;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .ai-hint {
    @apply text-xs text-ink-muted w-full mt-1;
  }

  .ai-hint a {
    @apply text-warm underline;
  }

  .ai-hint a:hover {
    @apply no-underline;
  }

  .filter-controls {
    @apply text-sm text-ink-secondary;
  }

  .filter-controls select {
    @apply ml-2 py-1 px-2 bg-card rounded text-ink;
    border: 1px solid var(--color-border);
    font-family: var(--font-sans);
  }

  /* ── Feed & Cards ─────────────────────────────────────────────── */
  .archive-feed {
    @apply flex flex-col gap-3;
    container-type: inline-size;
  }

  .archive-group {
    @apply mb-6;
  }

  .group-header {
    @apply flex justify-between items-baseline mb-3 pb-1.5;
    border-bottom: 2px solid var(--color-border);
  }

  .group-title {
    @apply font-serif text-xl m-0;
  }

  .group-actions button {
    @apply text-sm text-warm cursor-pointer p-0 bg-transparent border-none underline;
    text-underline-offset: 3px;
  }

  .group-actions button:hover {
    @apply text-ink;
  }

  /* ── Archive Card ─────────────────────────────────────────────── */
  .archive-card {
    @apply bg-card rounded p-3;
    border: 1px solid var(--color-border);
    display: grid;
    grid-template-areas:
      "icon content actions";
    grid-template-columns: 24px 1fr auto;
    gap: 0.625rem;
    align-items: center;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }

  .archive-card:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    border-color: var(--color-warm);
  }

  .card-favicon {
    grid-area: icon;
    @apply w-6 h-6 rounded object-contain;
  }

  .card-content {
    grid-area: content;
    @apply min-w-0;
  }

  .card-title {
    @apply text-sm font-medium m-0 leading-snug flex items-center gap-1.5;
    font-family: var(--font-sans);
    min-width: 0;
  }

  .card-title a {
    @apply text-ink no-underline truncate;
  }

  .card-title a:hover {
    @apply underline;
    text-decoration-color: var(--color-warm);
  }

  .card-summary {
    @apply text-ink-secondary text-xs mt-0.5 leading-snug;
  }

  .card-summary ul {
    @apply m-0 pl-4;
  }

  .card-summary li {
    @apply mb-0;
  }

  .card-summary p {
    @apply m-0;
  }

  .card-footer {
    grid-area: actions;
    @apply flex items-center gap-3 text-xs text-ink-muted;
  }

  .restore-btn {
    @apply bg-transparent py-0.5 px-2 rounded cursor-pointer text-ink-secondary text-xs;
    border: 1px solid var(--color-border);
    transition: all 0.2s;
    white-space: nowrap;
  }

  .restore-btn:hover {
    @apply bg-warm text-white;
    border-color: var(--color-warm);
  }

  .resummarize-btn {
    @apply bg-transparent py-0.5 px-2 rounded cursor-pointer text-ink-muted text-xs;
    border: 1px solid var(--color-border);
    transition: all 0.2s;
    white-space: nowrap;
  }

  .resummarize-btn:hover {
    border-color: var(--color-warm);
    color: var(--color-warm);
  }

  .resummarize-btn:disabled {
    @apply opacity-60 cursor-not-allowed;
  }

  /* ── Card Badges ──────────────────────────────────────────────── */
  .card-badge {
    @apply text-[10px] font-semibold uppercase tracking-wide py-0 px-1.5 rounded-sm;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .card-badge--swept {
    color: var(--color-red);
    background: color-mix(in srgb, var(--color-red) 10%, transparent);
    border: 1px solid color-mix(in srgb, var(--color-red) 25%, transparent);
  }

  /* ── Swept Card Variant ───────────────────────────────────────── */
  .archive-card--swept {
    opacity: 0.75;
    border-style: dashed;
  }

  .archive-card--swept:hover {
    opacity: 1;
  }

  /* ── Timestamp ────────────────────────────────────────────────── */
  .card-timestamp {
    white-space: nowrap;
  }

  /* ── Empty State ──────────────────────────────────────────────── */
  .empty-state {
    @apply text-center py-16 text-ink-muted italic font-serif text-xl bg-card rounded-lg;
    border: 1px dashed var(--color-border);
  }

  /* ── Buttons ──────────────────────────────────────────────────── */
  .btn {
    @apply inline-block py-2.5 px-5 rounded font-medium no-underline cursor-pointer text-base font-sans border-none;
    transition: opacity 0.2s;
  }

  .btn:hover {
    @apply opacity-90;
  }

  .btn-primary {
    @apply bg-warm text-white;
  }

  .btn-secondary {
    @apply bg-card text-ink-secondary;
    border: 1px solid var(--color-border);
  }

  .btn:disabled {
    @apply opacity-50 cursor-not-allowed;
  }

  .btn-sm {
    @apply py-1.5 px-3 text-sm;
  }

  /* ── Search Bar ───────────────────────────────────────────────── */
  .search-bar {
    @apply mb-8;
  }

  .search-input {
    @apply w-full py-3 px-4 bg-card rounded-lg text-ink text-base font-sans;
    border: 1px solid var(--color-border);
    transition: border-color 0.2s;
  }

  .search-input::placeholder {
    @apply text-ink-muted;
  }

  .search-input:focus {
    border-color: var(--color-warm);
    outline: none;
  }

  /* ── Export Bar ────────────────────────────────────────────────── */
  .export-bar {
    @apply flex items-center justify-center gap-3 mb-10;
  }

  .export-label {
    @apply text-sm text-ink-muted;
  }

  /* ── Footer / Donation (Gratitude) ────────────────────────────── */
  .digest-footer {
    @apply mt-16 pt-10 text-center;
    border-top: 1px solid var(--color-border);
  }

  .donation-prompt {
    @apply p-10 rounded-2xl max-w-xl mx-auto;
    background-color: color-mix(in srgb, var(--color-paper) 95%, var(--color-warm));
  }

  .donation-text {
    @apply font-serif text-xl mb-2;
  }

  .donation-tagline {
    @apply font-serif text-base text-ink-secondary mb-4 italic;
  }

  .privacy-note {
    @apply text-sm text-ink-muted mb-6;
  }

  .donation-hearts {
    @apply text-2xl mb-4;
    letter-spacing: 0.3em;
  }
}

/* ── Responsive ──────────────────────────────────────────────────── */
@media (max-width: 640px) {
  .stats-grid {
    @apply grid-cols-1 gap-3;
  }

  .actions-bar {
    @apply flex-col gap-3 items-start;
  }

  .archive-card {
    grid-template-areas:
      "content"
      "actions";
    grid-template-columns: 1fr;
  }

  .card-favicon {
    display: none;
  }
}

/* ── Dark Mode ───────────────────────────────────────────────────── */
@media (prefers-color-scheme: dark) {
  :root {
    --color-paper: #1a1918;
    --color-card: #242321;
    --color-ink: #e6e2dd;
    --color-ink-secondary: #a8a49e;
    --color-ink-muted: #6b6863;
    --color-border: #363430;
    --color-warm: #c59d75;
    --color-warm-hover: #b8905a;
  }

  .donation-prompt {
    background-color: #242321;
  }
}
